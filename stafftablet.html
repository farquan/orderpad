<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="refresh" content="300">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#10b981">
    
    <title>Staff Tablet - Task Board</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        :root {
            /* --- PALETTE: ROYAL BLUE THEME --- */
            --bg-gradient: linear-gradient(90deg, #5375ff 0%, #5d5bf8 100%);
            --card-bg: #1f2937; 
            --text-dark: #f3f4f6; 
            --text-light: #d1d5db; 
            
            /* Accents */
            --col-opening: #22d3ee;
            --col-day: #fbbf24;
            --col-closing: #e879f9;
            --col-multi: #a78bfa;
            
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; }
        
        body { 
            margin: 0; 
            padding: 0; 
            font-family: 'Poppins', sans-serif; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            color: var(--text-dark); 
            background: var(--bg-gradient);
            background-attachment: fixed;
            background-size: cover;
        }
        
        /* HEADER - GREEN BACKGROUND */
        .header-bar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 25px; 
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            color: white; 
            flex-shrink: 0; 
            z-index: 20; 
            position: relative; 
        }
        
        h2 { margin: 0; font-size: 22px; font-weight: 700; letter-spacing: 0.5px; text-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px; } 
        
        .header-right { display: flex; align-items: center; gap: 10px; }
        
        #date-display { 
            font-size: 20px; 
            font-weight: 700; 
            color: rgba(255,255,255,0.95); 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            margin-left: 10px;
        }
        
        #clock { 
            font-size: 20px; font-weight: 700; color: #ffffff; 
            font-family: 'Poppins', monospace; 
            background: rgba(255,255,255,0.2); 
            backdrop-filter: blur(5px);
            padding: 6px 16px; border-radius: 12px; 
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            margin-left: 5px;
        }

        /* BUTTON STYLES */
        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .header-btn:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-1px); }
        .header-btn:active { transform: scale(0.96); }

        /* Full Screen Button Specific Style */
        .fs-btn { background: #2563eb; border-color: #60a5fa; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .fs-btn:hover { background: #1d4ed8; }

        .logs-btn { background: rgba(0,0,0,0.4); border-color: rgba(0,0,0,0.5); color: #fbbf24; }

        .edit-ticker-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: background 0.2s;
            margin-left: 5px;
        }
        .edit-ticker-btn:hover { background: rgba(255, 255, 255, 0.4); }

        /* --- CHALKBOARD NOTICEBOARD CSS --- */
        .chalkboard {
            width: 95%;
            margin: 15px auto 15px auto;
            background-color: #262626;
            border: 8px solid #5c4033;
            border-radius: 4px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            padding: 15px;
            font-family: 'Patrick Hand', cursive;
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: relative;
            color: #eeeeee;
            flex-shrink: 0;
        }

        .chalkboard::after {
            content: ''; position: absolute; bottom: -8px; left: -8px; right: -8px;
            height: 4px; background: rgba(0,0,0,0.3);
        }

        .chalk-urgent-row {
            border-bottom: 1px dashed rgba(255,255,255,0.3);
            padding-bottom: 8px;
            margin-bottom: 2px;
            font-size: 20px;
            color: #ff6b6b;
            display: flex; align-items: center; gap: 10px;
        }
        
        .urgent-badge {
            background: #c53030; color: white;
            font-family: 'Poppins', sans-serif; font-size: 11px; font-weight: 700;
            padding: 2px 6px; border-radius: 4px; letter-spacing: 1px;
        }

        .chalk-general-text {
            font-size: 22px;
            color: #ffffff;
            line-height: 1.3;
            white-space: pre-line;
        }

        /* TASK PANEL */
        #task-panel { 
            flex-grow: 1; 
            padding: 20px; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
            gap: 5px; 
            background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px); 
            background-size: 30px 30px; 
        }

        /* SECTION TITLE */
        .section-title { 
            font-size: 14px; 
            font-weight: 700; 
            color: rgba(255,255,255,0.9); 
            margin: 8px 0 5px 0; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            cursor: pointer; 
            user-select: none;
            transition: all 0.3s ease;
            padding: 12px 15px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
        }
        .section-title:active { opacity: 0.9; transform: scale(0.99); }
        
        .section-title span.icon-box { 
            background: rgba(0,0,0,0.2); color: white; width: 32px; height: 32px; 
            display: flex; align-items: center; justify-content: center; 
            border-radius: 10px; font-size: 18px; 
            border: 1px solid rgba(255,255,255,0.1); 
        }

        /* STATUS CLASSES */
        .title-green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            border: 1px solid #34d399;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .title-red {
            background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            border: 1px solid #f87171;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .section-note { 
            margin-left: auto; 
            font-size: 11px; font-weight: 600; 
            background: rgba(0,0,0,0.2); padding: 4px 10px; border-radius: 20px; 
            color: #e5e7eb; border: 1px solid rgba(255,255,255,0.2); 
        }

        .toggle-arrow {
            margin-left: 10px;
            font-size: 12px;
            opacity: 0.8;
            transition: transform 0.2s;
        }

        .daily-row { 
            display: flex; gap: 15px; overflow-x: auto; 
            padding: 5px; 
            white-space: nowrap; -webkit-overflow-scrolling: touch; 
            min-height: 95px; 
            scrollbar-width: none; align-items: center; transition: all 0.3s ease; 
        }
        
        .daily-row::-webkit-scrollbar { display: none; }
        
        /* LOCKED STATE */
        .locked { 
            opacity: 0.3; 
            filter: grayscale(100%); 
            pointer-events: none; 
        }
        
        /* CARD STYLES */
        .daily-card { 
            min-width: 160px; 
            height: 82px; 
            background: var(--card-bg); 
            border-radius: 16px; padding: 12px; 
            box-shadow: var(--card-shadow); 
            display: flex; flex-direction: column; justify-content: center; 
            cursor: pointer; white-space: normal; position: relative; 
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); 
            border: 1px solid rgba(255,255,255,0.05); 
            overflow: hidden; 
        }
        
        .daily-card:active { transform: scale(0.96); }
        .daily-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); border-color: rgba(255,255,255,0.2); }
        .daily-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; }
        
        .daily-card strong { 
            font-size: 14px; 
            display: block; 
            line-height: 1.2; 
            margin-top: 10px; 
            margin-bottom: 2px; 
            color: var(--text-dark); 
            font-weight: 600;
        }
        
        .card-subtext { 
            font-size: 10px; 
            color: var(--text-light); 
            margin-top: 0; 
            font-weight: 500; 
        }

        .due-badge { position: absolute; top: 8px; right: 8px; font-size: 10px; font-weight: 700; background: #374151; color: #e5e7eb; padding: 3px 6px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        
        /* STACKED CARD STYLES */
        .card-stack { overflow: visible !important; margin-right: 15px; }
        .card-stack::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--card-bg); border-radius: 16px; border: 1px solid rgba(255,255,255,0.05);
            z-index: -1; transform: rotate(5deg);
            box-shadow: var(--card-shadow); opacity: 0.6;
        }
        .card-stack::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--card-bg); border-radius: 16px; border: 1px solid rgba(255,255,255,0.05);
            z-index: -2; transform: rotate(10deg);
            box-shadow: var(--card-shadow); opacity: 0.3;
        }
        .stack-top-layer {
            position: absolute; top:0; left:0; width:100%; height:100%; 
            background: var(--card-bg); border-radius:16px; z-index:2; padding:12px;
            display:flex; flex-direction:column; justify-content: center;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .stack-bar { position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: var(--col-multi); border-top-left-radius: 16px; border-bottom-left-radius: 16px;}

        /* COLORS */
        .opening-card::before { background: var(--col-opening); box-shadow: 0 0 10px var(--col-opening); }
        .day-card::before { background: var(--col-day); box-shadow: 0 0 10px var(--col-day); }
        .closing-card::before { background: var(--col-closing); box-shadow: 0 0 10px var(--col-closing); }

        .green { background: #059669 !important; color: white !important; border: 1px solid #34d399 !important; box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); }
        .green strong { color: white; }
        .green .card-subtext { color: rgba(255,255,255,0.9); }
        
        .add-btn-inline { 
            width: 100%; margin-top: 20px; padding: 18px; 
            background-color: rgba(255,255,255,0.1); border: 2px dashed #ffffff; border-radius: 16px; 
            color: #ffffff; font-size: 15px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; 
            transition: all 0.2s;
        }
        .add-btn-inline:active { background: rgba(255, 255, 255, 0.2); transform: scale(0.98); }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px); z-index: 200; align-items: center; justify-content: center; }
        .modal-box { background: #1f2937; padding: 30px; border-radius: 24px; width: 340px; text-align: center; border: 1px solid #374151; box-shadow: 0 20px 40px rgba(0,0,0,0.4); color: white; }
        .save-btn { flex: 1; padding: 14px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .cancel-btn { flex: 1; padding: 14px; background: #374151; color: #d1d5db; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer;}
        input, select, textarea { width: 100%; padding: 15px; margin-bottom: 20px; background: #111827; border: 2px solid #374151; border-radius: 12px; font-family: 'Poppins', sans-serif; color: white; outline: none; transition: border-color 0.2s; resize: none; }
        input:focus, select:focus, textarea:focus { border-color: #6366f1; }
        .hidden { display: none !important; }
        
        .form-label { text-align: left; display: block; margin-bottom: 5px; font-size: 12px; color: #94a3b8; }

        /* TILL TOGGLE BUTTONS */
        .till-btn {
            flex: 1;
            padding: 12px;
            background: #374151;
            border: 2px solid transparent;
            border-radius: 10px;
            color: #9ca3af;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            transition: all 0.2s;
        }
        .till-btn:hover { background: #4b5563; }
        .till-btn.active {
            background: #2563eb;
            color: white;
            border-color: #60a5fa;
            box-shadow: 0 0 10px rgba(37, 99, 235, 0.4);
        }

        /* LOG VIEWER STYLES */
        .log-table-container { max-height: 400px; overflow-y: auto; text-align: left; margin-top: 10px; border: 1px solid #374151; border-radius: 10px; }
        .log-table { width: 100%; border-collapse: collapse; font-size: 12px; color: #d1d5db; }
        .log-table th { background: #374151; padding: 10px; position: sticky; top: 0; text-align: left; color: white; }
        .log-table td { padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .log-table tr:hover { background: rgba(255,255,255,0.05); }
        .tab-btn { background: #374151; color: #9ca3af; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; margin-right: 5px; }
        .tab-btn.active { background: #2563eb; color: white; }

        /* PRESET & SUPPLIER GRID STYLES */
        .preset-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 20px; }
        .preset-btn { background: #374151; border: 1px solid rgba(255,255,255,0.05); color: #d1d5db; padding: 10px 5px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; font-family: 'Poppins', sans-serif; transition: all 0.2s; }
        .preset-btn:hover { background: #4b5563; color: white; border-color: rgba(255,255,255,0.2); }
        .preset-btn:active { transform: scale(0.95); }

        .supplier-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .supplier-btn { background: #374151; border: 2px solid transparent; color: #f3f4f6; padding: 15px; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; text-align: center; transition: all 0.2s; }
        .supplier-btn:hover { background: #4b5563; }
        .supplier-btn.active { background: #2563eb; border-color: #60a5fa; color: white; box-shadow: 0 0 10px rgba(37, 99, 235, 0.4); }

    </style>
</head>
<body>

    <div class="header-bar">
        <h2>‚ú® Staff Board</h2>
        <div class="header-right">
            <button class="header-btn fs-btn" onclick="toggleFullScreen()">üñ•Ô∏è Full Screen</button>
            
            <button class="header-btn" onclick="playSound('click'); alert('Lunch & Break Rota coming soon!')">ü•™ Lunch Rota</button>
            <button class="header-btn" onclick="playSound('click'); openPayoutModal()">üí∏ Pay Outs</button>
            <button class="header-btn" onclick="playSound('click'); openSafeDropModal()">üîí Safe Drops</button>
            <button class="header-btn logs-btn" onclick="playSound('click'); openPinModal()">üìã View Logs</button>
            
            <button class="edit-ticker-btn" onclick="playSound('click'); openEditTickerModal()">‚öôÔ∏è</button>
            <div id="date-display">Mon 01 Jan</div>
            <div id="clock">00:00</div>
        </div>
    </div>

    <div class="chalkboard">
        <div class="chalk-urgent-row">
            <span class="urgent-badge">URGENT</span>
            <span id="ticker-urgent-text">Freezer #2 is running warm (-5¬∞). Engineer called.</span>
        </div>
        <div id="ticker-general-text" class="chalk-general-text">
            New stock delivery expected at 14:00 today.
        </div>
    </div>
    
    <div id="task-panel">
        
        <div class="section-title" id="openingTitle" onclick="playSound('click'); manualToggle('openingList', 'openingArrow')">
            <span class="icon-box">üåÖ</span> Opening Duties
            <span id="openingArrow" class="toggle-arrow">‚ñº</span>
        </div>
        <div class="daily-row" id="openingList"></div>
        
        <div class="section-title"><span class="icon-box">‚è∞</span> Repeatable Prep</div>
        <div class="daily-row" id="multiList"></div>

        <div class="section-title"><span class="icon-box">‚òÄÔ∏è</span> Day Duties</div>
        <div class="daily-row" id="dayList"></div>

        <div class="section-title" id="closingTitle" onclick="playSound('click'); manualToggle('closingList', 'closingArrow')">
            <span class="icon-box">üåô</span> Closing Duties 
            <span class="section-note">(Unlocks 20:00)</span>
            <span id="closingArrow" class="toggle-arrow">‚ñº</span>
        </div>
        <div class="daily-row" id="closingList"></div>

        <button class="add-btn-inline" onclick="playSound('click'); openAddModal()">‚ûï Add New Task</button>
    </div>

    <div id="sign-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>Sign Off</h3>
            <p id="signOffPrompt" style="color:#94a3b8; margin-bottom:20px;"></p>
            <input type="text" id="initials" maxlength="3" style="text-align:center; font-size:24px; text-transform:uppercase;" placeholder="Initials">
            <div style="display:flex;gap:15px;">
                <button class="cancel-btn" onclick="playSound('click'); closeModal('sign-modal')">Back</button>
                <button class="save-btn" onclick="confirmComplete()">Confirm</button>
            </div>
        </div>
    </div>

    <div id="payout-modal" class="modal-overlay">
        <div class="modal-box" style="width: 450px;"> 
            <h3>üí∏ Pay Out</h3>
            <label class="form-label">Select Supplier</label>
            <div class="supplier-grid">
                <div class="supplier-btn" onclick="playSound('click'); selectSupplier(this, 'Coca Cola')">Coca Cola</div>
                <div class="supplier-btn" onclick="playSound('click'); selectSupplier(this, 'Walkers')">Walkers</div>
                <div class="supplier-btn" onclick="playSound('click'); selectSupplier(this, 'Bakery')">Bakery</div>
                <div class="supplier-btn" onclick="playSound('click'); selectSupplier(this, 'Milkman')">Milkman</div>
                <div class="supplier-btn" onclick="playSound('click'); selectSupplier(this, 'Window Cleaner')">Window Cleaner</div>
                <div class="supplier-btn" onclick="playSound('click'); selectSupplier(this, 'Other')">Other</div>
            </div>
            <input type="hidden" id="payout-supplier">
            <label class="form-label">Amount (¬£)</label>
            <input type="number" id="payout-amount" placeholder="0.00" step="0.01" style="margin-bottom: 10px;">
            <div class="preset-grid">
                <button class="preset-btn" onclick="playSound('click'); setPayoutAmount(100)">¬£100</button>
                <button class="preset-btn" onclick="playSound('click'); setPayoutAmount(200)">¬£200</button>
                <button class="preset-btn" onclick="playSound('click'); setPayoutAmount(300)">¬£300</button>
                <button class="preset-btn" onclick="playSound('click'); setPayoutAmount(400)">¬£400</button>
                <button class="preset-btn" onclick="playSound('click'); setPayoutAmount(500)">¬£500</button>
            </div>
            <label class="form-label">Paid From</label>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button id="po-till-1" class="till-btn" onclick="playSound('click'); selectTill('po', 1)">Till 1</button>
                <button id="po-till-2" class="till-btn" onclick="playSound('click'); selectTill('po', 2)">Till 2</button>
            </div>
            <div style="display:flex;gap:15px;">
                <button class="cancel-btn" onclick="playSound('click'); closeModal('payout-modal')">Cancel</button>
                <button class="save-btn" onclick="savePayout()">Confirm</button>
            </div>
        </div>
    </div>

    <div id="safedrop-modal" class="modal-overlay">
        <div class="modal-box" style="width: 400px;"> 
            <h3>üîí Safe Drop</h3>
            <label class="form-label">Amount Dropped (¬£)</label>
            <input type="number" id="sd-amount" placeholder="0.00" step="0.01" style="margin-bottom: 20px; font-size:24px; text-align:center;">
            
            <label class="form-label">Dropped From</label>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button id="sd-till-1" class="till-btn" onclick="playSound('click'); selectTill('sd', 1)">Till 1</button>
                <button id="sd-till-2" class="till-btn" onclick="playSound('click'); selectTill('sd', 2)">Till 2</button>
            </div>
            
            <label class="form-label">Witness Initials</label>
            <input type="text" id="sd-witness" maxlength="3" style="text-align:center; text-transform:uppercase;" placeholder="Witness">

            <div style="display:flex;gap:15px;">
                <button class="cancel-btn" onclick="playSound('click'); closeModal('safedrop-modal')">Cancel</button>
                <button class="save-btn" onclick="saveSafeDrop()">Confirm Drop</button>
            </div>
        </div>
    </div>

    <div id="pin-modal" class="modal-overlay">
        <div class="modal-box" style="width: 300px;">
            <h3>üîê Enter PIN</h3>
            <input type="password" id="pin-input" maxlength="4" style="text-align:center; font-size:32px; letter-spacing:10px;" placeholder="****">
            <div style="display:flex;gap:15px;">
                <button class="cancel-btn" onclick="closeModal('pin-modal')">Cancel</button>
                <button class="save-btn" onclick="verifyPin()">Unlock</button>
            </div>
        </div>
    </div>

    <div id="logs-modal" class="modal-overlay">
        <div class="modal-box" style="width: 600px; max-width:90%;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3>üìã Daily Logs</h3>
                <button class="cancel-btn" style="flex:0; padding:5px 10px;" onclick="closeModal('logs-modal')">‚úñ</button>
            </div>
            
            <div style="display:flex; margin-bottom:10px;">
                <button class="tab-btn active" onclick="switchLogTab(this, 'tasks')">Tasks</button>
                <button class="tab-btn" onclick="switchLogTab(this, 'safedrops')">Safe Drops</button>
                <button class="tab-btn" onclick="switchLogTab(this, 'payouts')">Pay Outs</button>
            </div>

            <div class="log-table-container">
                <table class="log-table" id="log-table-body">
                    </table>
            </div>
        </div>
    </div>

    <div id="edit-ticker-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>Edit Chalkboard</h3>
            
            <label class="form-label">Urgent Alert (Red)</label>
            <input type="text" id="input-urgent">
            
            <label class="form-label">General Messages (White)</label>
            <textarea id="input-general" rows="5"></textarea>
            
            <div style="display:flex;gap:15px;">
                <button class="cancel-btn" onclick="closeModal('edit-ticker-modal')">Cancel</button>
                <button class="save-btn" onclick="saveTicker()">Save</button>
            </div>
        </div>
    </div>

    <script>
        // --- NEW FULL SCREEN FUNCTION ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // --- SOUND & INIT ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            if (type === 'click') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(800, audioCtx.currentTime); 
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                osc.start(); osc.stop(audioCtx.currentTime + 0.05);
            } else if (type === 'success') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(523, audioCtx.currentTime); osc.frequency.setValueAtTime(659, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start(); osc.stop(audioCtx.currentTime + 0.4);
            } else if (type === 'error') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                osc.start(); osc.stop(audioCtx.currentTime + 0.2);
            }
        }

        // --- GLOBAL LOGGING FUNCTION ---
        function addToLog(type, details) {
            const now = new Date();
            const entry = {
                type: type,
                time: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                date: now.toLocaleDateString(),
                details: details
            };
            
            let logs = JSON.parse(localStorage.getItem('staffLogs')) || [];
            logs.unshift(entry); // Add to top
            localStorage.setItem('staffLogs', JSON.stringify(logs));
        }

        // --- LOG VIEWER LOGIC ---
        function openPinModal() {
            document.getElementById('pin-modal').style.display = 'flex';
            document.getElementById('pin-input').value = '';
            document.getElementById('pin-input').focus();
        }

        function verifyPin() {
            const pin = document.getElementById('pin-input').value;
            if (pin === "1234") {
                closeModal('pin-modal');
                openLogsModal();
            } else {
                playSound('error');
                alert("Incorrect PIN");
            }
        }

        function openLogsModal() {
            document.getElementById('logs-modal').style.display = 'flex';
            renderLogs('tasks');
        }

        function switchLogTab(btn, type) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderLogs(type);
        }

        function renderLogs(filterType) {
            const logs = JSON.parse(localStorage.getItem('staffLogs')) || [];
            const table = document.getElementById('log-table-body');
            table.innerHTML = "";

            // Mapping for display
            let headers = "";
            if (filterType === 'tasks') headers = "<tr><th>Time</th><th>Task Name</th><th>Staff</th></tr>";
            if (filterType === 'safedrops') headers = "<tr><th>Time</th><th>Amount</th><th>Till</th><th>Witness</th></tr>";
            if (filterType === 'payouts') headers = "<tr><th>Time</th><th>Amount</th><th>Supplier</th><th>Till</th></tr>";
            
            table.innerHTML = headers;

            const filtered = logs.filter(l => {
                if(filterType === 'tasks') return l.type === 'TASK_COMPLETE';
                if(filterType === 'safedrops') return l.type === 'SAFE_DROP';
                if(filterType === 'payouts') return l.type === 'PAYOUT';
                return false;
            });

            if (filtered.length === 0) {
                table.innerHTML += "<tr><td colspan='4' style='text-align:center; padding:20px; color:#6b7280;'>No logs found for this category.</td></tr>";
                return;
            }

            filtered.forEach(log => {
                let row = `<tr><td>${log.date} ${log.time}</td>`;
                
                if (filterType === 'tasks') {
                    row += `<td>${log.details.task}</td><td>${log.details.staff}</td>`;
                } else if (filterType === 'safedrops') {
                    row += `<td>¬£${log.details.amount}</td><td>Till ${log.details.till}</td><td>${log.details.witness}</td>`;
                } else if (filterType === 'payouts') {
                    row += `<td>¬£${log.details.amount}</td><td>${log.details.supplier}</td><td>Till ${log.details.till}</td>`;
                }
                row += "</tr>";
                table.innerHTML += row;
            });
        }

        // --- SAFE DROP LOGIC ---
        let selectedTillSD = 1;
        function openSafeDropModal() {
            document.getElementById('safedrop-modal').style.display = 'flex';
            document.getElementById('sd-amount').value = '';
            document.getElementById('sd-witness').value = '';
            selectTill('sd', 1);
        }
        function saveSafeDrop() {
            const amt = document.getElementById('sd-amount').value;
            const wit = document.getElementById('sd-witness').value.toUpperCase();
            
            if(!amt || !wit) { playSound('error'); return alert("Fill all fields"); }
            
            addToLog('SAFE_DROP', { amount: amt, till: selectedTillSD, witness: wit });
            
            playSound('success');
            alert(`‚úÖ Safe Drop Recorded: ¬£${amt}`);
            closeModal('safedrop-modal');
        }

        // --- PAYOUT LOGIC ---
        let selectedTillPO = 1; 
        function openPayoutModal() {
            document.getElementById('payout-modal').style.display = 'flex';
            document.getElementById('payout-amount').value = ''; 
            selectTill('po', 1); 
            document.querySelectorAll('.supplier-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('payout-supplier').value = '';
        }
        function setPayoutAmount(amount) { document.getElementById('payout-amount').value = amount; }
        function selectSupplier(el, name) {
            document.querySelectorAll('.supplier-btn').forEach(btn => btn.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('payout-supplier').value = name;
        }
        function selectTill(context, num) {
            if(context === 'po') {
                selectedTillPO = num;
                document.getElementById('po-till-1').className = num === 1 ? 'till-btn active' : 'till-btn';
                document.getElementById('po-till-2').className = num === 2 ? 'till-btn active' : 'till-btn';
            } else {
                selectedTillSD = num;
                document.getElementById('sd-till-1').className = num === 1 ? 'till-btn active' : 'till-btn';
                document.getElementById('sd-till-2').className = num === 2 ? 'till-btn active' : 'till-btn';
            }
        }
        function savePayout() {
            const supp = document.getElementById('payout-supplier').value;
            const amt = document.getElementById('payout-amount').value;
            if(!supp || !amt) { playSound('error'); return alert("Missing info"); }
            
            addToLog('PAYOUT', { amount: amt, supplier: supp, till: selectedTillPO });

            playSound('success'); 
            alert(`‚úÖ Payout Recorded: ¬£${amt}`);
            closeModal('payout-modal');
        }

        // --- TICKER & GENERAL ---
        function manualToggle(listId, arrowId) {
            const list = document.getElementById(listId);
            const arrow = document.getElementById(arrowId);
            if (list.classList.contains('hidden')) { list.classList.remove('hidden'); arrow.innerText = '‚ñº'; }
            else { list.classList.add('hidden'); arrow.innerText = '‚óÄ'; }
        }
        function openEditTickerModal() {
            document.getElementById('input-urgent').value = document.getElementById('ticker-urgent-text').innerText;
            document.getElementById('input-general').value = document.getElementById('ticker-general-text').innerText;
            document.getElementById('edit-ticker-modal').style.display = 'flex';
        }
        function saveTicker() {
            const u = document.getElementById('input-urgent').value;
            const g = document.getElementById('input-general').value;
            document.getElementById('ticker-urgent-text').innerText = u;
            document.getElementById('ticker-general-text').innerText = g;
            localStorage.setItem('tickerUrgent', u); localStorage.setItem('tickerGeneral', g);
            playSound('success'); closeModal('edit-ticker-modal');
        }
        function loadSavedTicker() {
            const u = localStorage.getItem('tickerUrgent');
            const g = localStorage.getItem('tickerGeneral');
            if(u) document.getElementById('ticker-urgent-text').innerText = u;
            if(g) document.getElementById('ticker-general-text').innerText = g;
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function openAddModal() { alert("Add task functionality placeholder"); }

        // --- TASK LISTS ---
        const openingTasks = [{name:"Temp Check",time:"10:00"},{name:"Milk/Eggs Stock",time:"10:30"}];
        let vegStack = {name:"Check Fruit/Veg",times:["11:00","15:00","19:00"],current:0};
        const dayTasks = [{name:"Bins Emptied",time:"14:00"}];
        const closingTasks = [{name:"Phone Charge",time:"20:30"},{name:"Freezers Closed",time:"20:30"},{name:"Zettle Charged",time:"20:30"},{name:"Bags Stacked",time:"20:30"},{name:"Till Roll",time:"20:30"},{name:"Bins",time:"20:30"},{name:"Onions/Potatoes",time:"20:45"},{name:"HAACP",time:"21:00"},{name:"Final Temps",time:"21:00"},{name:"Side Door",time:"21:15"}];

        window.onload = function() {
            populateList('openingList', openingTasks, 'opening-card');
            renderVegStack(); populateList('dayList', dayTasks, 'day-card');
            populateList('closingList', closingTasks, 'closing-card');
            updateClock(); loadSavedTicker();
            updateAllSections(); // Initial check on load
        };

        function populateList(cid, tasks, cls) {
            const c = document.getElementById(cid); c.innerHTML = ""; 
            tasks.forEach(t => {
                let d = document.createElement('div'); d.className = `daily-card ${cls}`;
                d.onclick = function() { playSound('click'); openSignOff(this, t.name, false); };
                d.innerHTML = `<span class="due-badge">${t.time}</span><strong>${t.name}</strong><div class="card-subtext">Tap to complete</div>`;
                c.appendChild(d);
            });
        }
        function renderVegStack() {
            const c = document.getElementById('multiList'); c.innerHTML = ""; 
            let d = document.createElement('div');
            if(vegStack.current >= vegStack.times.length) {
                d.className = "daily-card green"; d.innerHTML = `<strong>‚úÖ ${vegStack.name}</strong><div class="card-subtext">Complete</div>`;
            } else {
                d.className = "daily-card card-stack";
                let nt = vegStack.times[vegStack.current];
                d.innerHTML = `<div class="stack-top-layer"><div class="stack-bar"></div><span class="due-badge">${nt}</span><strong>${vegStack.name}</strong><div class="card-subtext">Tap to sign off (${vegStack.current + 1}/${vegStack.times.length})</div></div>`;
                d.onclick = function() { playSound('click'); openSignOff(this, `${vegStack.name} (${nt})`, true); };
            }
            c.appendChild(d);
        }

        // --- UPDATED CLOCK FUNCTION ---
        let autoClosedOpening = false;

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
            document.getElementById('date-display').innerText = now.toLocaleDateString('en-GB', {weekday:'short',day:'numeric',month:'short'});
            if(document.getElementById('live-ticker-time')) document.getElementById('live-ticker-time').textContent = now.toLocaleDateString() + " " + now.toLocaleTimeString();
            
            const mins = (now.getHours()*60)+now.getMinutes();
            const currentHour = now.getHours();

            // 1. AUTO-MINIMIZE OPENING DUTIES (10 AM)
            if (currentHour >= 10 && !autoClosedOpening) {
                const oList = document.getElementById('openingList');
                if (oList && !oList.classList.contains('hidden')) {
                     manualToggle('openingList', 'openingArrow');
                }
                autoClosedOpening = true; 
            }

            // 2. LOCK CLOSING DUTIES (Before 8 PM)
            const locked = mins < 1200; // 1200 mins = 20:00 (8 PM)
            document.getElementById('closingList').classList.toggle('locked', locked);
            
            updateAllSections(); 
            setTimeout(updateClock, 10000);
        }

        // --- UPDATED COLOR STATUS LOGIC ---
        function updateAllSections() {
            updateSectionStatus('openingList', 'openingTitle', 'openingArrow');
            updateSectionStatus('closingList', 'closingTitle', 'closingArrow');
        }

        function updateSectionStatus(listId, titleId, arrowId) {
            const list = document.getElementById(listId);
            const title = document.getElementById(titleId);
            const arrow = document.getElementById(arrowId);
            
            if(!list || !title) return;

            const total = list.children.length;
            const completed = list.querySelectorAll('.green').length;
            const now = new Date();
            const currentHour = now.getHours();

            title.classList.remove('title-green', 'title-red');

            if (total > 0) {
                if (completed === total) {
                    title.classList.add('title-green');
                    if (!list.classList.contains('hidden')) {
                         manualToggle(listId, arrowId); 
                    }
                } else {
                    if (listId === 'closingList') {
                        if (currentHour < 20) {
                            return; 
                        }
                    }
                    title.classList.add('title-red');
                }
            }
        }

        let activeCard, activeTaskName, isStackedTask;
        function openSignOff(card, name, isStack) {
            activeCard = card; activeTaskName = name; isStackedTask = isStack;
            document.getElementById('signOffPrompt').innerText = `Sign off: ${name}`;
            document.getElementById('initials').value = "";
            document.getElementById('sign-modal').style.display = 'flex';
            document.getElementById('initials').focus();
        }

        function confirmComplete() {
            let init = document.getElementById('initials').value.toUpperCase();
            if(!init) { playSound('error'); return alert("Initials required!"); }
            
            if(isStackedTask) {
                vegStack.current++; renderVegStack();
                addToLog('TASK_COMPLETE', { task: activeTaskName, staff: init });
            } else {
                activeCard.classList.add('green');
                activeCard.innerHTML = `<strong>‚úÖ ${activeTaskName}</strong><div class="card-subtext">By ${init}</div>`;
                activeCard.onclick = null;
                addToLog('TASK_COMPLETE', { task: activeTaskName, staff: init });
                
                const listId = activeCard.parentElement.id;
                if(listId === 'openingList') updateSectionStatus('openingList', 'openingTitle', 'openingArrow');
                if(listId === 'closingList') updateSectionStatus('closingList', 'closingTitle', 'closingArrow');
            }
            playSound('success'); closeModal('sign-modal');
        }
    </script>
</body>
</html>