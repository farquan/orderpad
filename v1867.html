<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OrderPad v1867</title>
</head>
<body>

<button id="submitStockBtn">SUBMIT STOCK</button>

<script>
// Minimal runnable wrapper â€“ telegram split into two messages
// NOTE: This file mirrors the amended logic you asked for.
// It sends TWO Telegram messages: stock first, then URL.

// Dummy placeholders expected to be present in real app
window.ITEMS = window.ITEMS || ["Item A","Item B","Item C"];
window.state = window.state || { map: {
  "Item A": { stock: 8 },
  "Item B": { stock: 8 },
  "Item C": { stock: 8 }
}};

const BOT_TOKEN = "8478412877:AAHxot18T5GnPrBjPmiD6vHETpJenMoy5_0";
const CHAT_ID = 7782476287;

function submitStock() {

  var values = [];
  var lines = [];

  ITEMS.forEach(function(n){
    var v = (state.map[n] && state.map[n].stock) || 0;
    values.push(v);
    lines.push(n + ": " + v);
  });

  var encoded = btoa(values.join(","));
  var url =
    "https://farquan.github.io/orderpad/v1867.html" +
    "?d=" + encodeURIComponent(encoded) +
    "&t=" + Date.now();

  // Telegram message 1 â€“ STOCK
  fetch("https://api.telegram.org/bot" + BOT_TOKEN + "/sendMessage", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      chat_id: CHAT_ID,
      text: "FRUIT & VEG STOCK âœ…\n\n" + lines.join("\n")
    })
  })
  .then(function(){
    // Telegram message 2 â€“ URL
    return fetch("https://api.telegram.org/bot" + BOT_TOKEN + "/sendMessage", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        chat_id: CHAT_ID,
        text: "ðŸ”— Review link:\n" + url
      })
    });
  })
  .catch(function(err){
    console.error(err);
  });

  window.open(url, "_blank");
}

document.getElementById("submitStockBtn")
  .addEventListener("click", submitStock);
</script>

</body>
</html>
