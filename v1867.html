<!DOCTYPE html>
<html lang="en">
<!-- v1867 – Base64 ?d= prefill + critical item warning (COPY/WHATSAPP only) -->
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Running Order Pad v1867</title>
<meta name="theme-color" content="#0f1115">
<style>
:root{--bg:#0f1115;--card:#161a22;--ink:#e9eef5;--muted:#9fb0c2;--border:#242b3b;--green:#20c997;--red:#ff4d4d}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui}
.wrap{max-width:820px;margin:auto;padding:16px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin:14px 0}
.label{font-size:12px;color:var(--muted);margin-bottom:6px}
.area{white-space:pre-wrap;background:#0f141d;border:1px solid var(--border);border-radius:12px;padding:12px;font-size:15px}
.btn{border:0;border-radius:12px;padding:14px;font-weight:800;width:100%;cursor:pointer}
.btn.green{background:var(--green);color:#00150f}
.row{display:flex;gap:10px;margin-top:10px}
</style>
</head>
<body>
<div class="wrap">
<h2>Running Order</h2>

<div class="card">
<div class="label">ORDER — PASSIONS</div>
<div class="area" id="orderListPassions"></div>
<div class="row">
<button class="btn" id="copyPassions">COPY</button>
<a class="btn green" id="waPassions">WHATSAPP</a>
</div>
</div>
</div>

<script>
var state={map:{}};

var CRITICAL_ITEMS=["coriander","vine tomato","loose tomato","onion bag 4kg"];

(function(){
  var d=new URLSearchParams(location.search).get('d');
  if(!d) return;
  try{
    atob(d).split(/\r?\n/).forEach(function(line){
      var p=line.split('=');
      if(p.length!==2) return;
      var name=p[0].trim();
      var qty=p[1].trim();
      if(name.toLowerCase()==='coriander') return;
      if(!state.map[name]) state.map[name]={};
      state.map[name].order=qty;
    });
  }catch(e){}
})();

function checkCriticalItemsMissing(){
  var missing=[];
  CRITICAL_ITEMS.forEach(function(ci){
    var found=false;
    for(var n in state.map){
      if(n.toLowerCase()===ci){
        if(parseInt(state.map[n].order||0,10)>0) found=true;
      }
    }
    if(!found) missing.push(ci);
  });
  return missing.length
    ? "⚠️ POSSIBLE MISSING CORE ITEMS\n\n• "+missing.join("\n• ")
    : null;
}

function guarded(fn){
  var warn=checkCriticalItemsMissing();
  if(warn) alert(warn);
  fn();
}

function build(){
  var out=[];
  for(var n in state.map){
    if(parseInt(state.map[n].order||0,10)>0) out.push(state.map[n].order+' × '+n);
  }
  orderListPassions.textContent=out.join('\n');
}
build();

copyPassions.onclick=function(){
  guarded(()=>navigator.clipboard.writeText(orderListPassions.textContent||''));
};
waPassions.onclick=function(){ guarded(()=>{}); };
</script>
</body>
</html>
