<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0" name="viewport"/>
<title>Running Order Pad (Compat)</title>
<meta content="#0f1115" name="theme-color"/>
<style>
:root{
  --bg:#0f1115; --card:#161a22; --ink:#e9eef5; --muted:#9fb0c2; --border:#242b3b;
  --green:#20c997; --accent:#5c7cfa; --red:#ff4d4d; --orange:#ff9f43;
}
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;background:var(--bg);color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  touch-action: manipulation; /* stop smart zoom double/triple-tap */
}
.wrap{max-width:820px;margin:0 auto;padding:8px 14px 24px}

/* Light blue header bar */
header{
  position:sticky;top:0;z-index:20;
  background:#5c7cfa; color:#fff;
  backdrop-filter:none;
  border-bottom:1px solid var(--border)
}
.head{display:flex;align-items:center;justify-content:space-between;padding:10px 14px}
h1{
  margin:0;
  font-size:32px; /* ~20% smaller */
  font-weight:900;
  letter-spacing:.3px;
  text-align:center;
  flex:1;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* Hide the counter under the header */
.counter{display:none}

.navbtn{background:#0d1219;color:var(--ink);border:1px solid var(--border);border-radius:10px;padding:12px 6px;font-weight:700;width:20%}
.card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;margin:14px 0}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.label{font-size:12px;color:var(--muted);margin-bottom:6px}
.inp{width:100%;font-size:26px;font-weight:800;text-align:center;padding:14px;border-radius:14px;border:2px solid var(--border);background:#0f141d;color:#e9eef5}
.inp:focus{outline:none;box-shadow:0 0 0 3px rgba(92,124,250,.35)}
.btn{appearance:none;border:0;border-radius:14px;padding:14px 18px;font-weight:800;font-size:16px;cursor:pointer;width:100%}
.btn.green{background:var(--green);color:#00150f}
.btn.red{background:var(--red);color:#fff}
.btn.ghost{background:#0d1219;color:#e9eef5;border:1px solid var(--border)}
.note{width:100%;min-height:72px;padding:12px;border-radius:12px;border:1px solid var(--border);background:#0f141d;color:#e9eef5;font-size:16px}
.area{min-height:120px;white-space:pre-wrap;background:#0f141d;border:1px solid var(--border);border-radius:14px;padding:12px;font-size:15px;color:#e9eef5}
.copyopen{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;justify-content:center;}
#waPassions,#waMk,#waOther{display:block;text-align:center;}
.small{font-size:12px;color:#c6d2e0}
hr.sep{border:0;border-top:1px solid var(--border);margin:12px 0}

/* A–Z bar */
.azbar{display:flex;gap:6px;overflow:auto;padding:8px 10px;border-top:1px solid var(--border);border-bottom:1px solid var(--border);scrollbar-width:none;-ms-overflow-style:none;background:rgba(22,26,34,.9)}
.azbar::-webkit-scrollbar{display:none}
.azbtn{min-width:34px;padding:6px 0;border-radius:9px;border:1px solid var(--border);text-align:center;font-weight:800;background:#0d1219;color:#e9eef5;flex:0 0 auto}
.azbtn.active{outline:2px solid var(--accent)}
.azbtn:disabled{opacity:.35}

/* Hide the old status line entirely */
.status{display:none}

/* Button row */
.btnrow{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:12px}

/* Items Editor panel */
.editor{display:none}
.editor.open{display:block}
.textarea{width:100%;min-height:220px;padding:12px;border-radius:12px;border:1px solid var(--border);background:#0f141d;color:#e9eef5;font-size:14px}
.editorbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.editor-tools{display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap}
.editor-tools input{flex:1;min-width:160px;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0f141d;color:#e9eef5}
.counterline{margin-top:6px;color:var(--muted);font-size:12px}

/* Save To button colors */
.btn-passions { background:#20c997; color:#00150f; } /* green */
.btn-mk       { background:#5c7cfa; color:#ffffff; } /* blue */
.btn-other    { background:#ff9f43; color:#00150f; } /* orange */

.stepperwrap{display:flex;align-items:center;gap:10px}
.stepperwrap .inp{flex:1}
.stepbtn{appearance:none;border:1px solid var(--border);background:#0d1219;color:var(--ink);border-radius:10px;font-weight:900;font-size:18px;line-height:1;padding:10px 12px;min-width:44px}
.stepbtn:active{transform:translateY(1px)}


/* Progress area */
#progressWrap{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 14px;background:#5268f6;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
#progressBar{flex:1;height:8px;background:rgba(255,255,255,.25);border-radius:999px;overflow:hidden}
#progressFill{height:100%;width:0%;background:#20c997;transition:width .25s ease}
#progressRight{display:flex;align-items:center;gap:10px}
#progressTally{font-size:12px;opacity:.95}
#nextUnansweredBtn{width:auto;padding:8px 10px;font-size:12px}

#answeredTick { color:white; font-size:22px; margin-left:6px; display:none; }

/* Overall progress (top) */
#overallProgress{padding:10px 14px}
#overallBar{position:relative;height:12px;background:rgba(255,255,255,.25);border-radius:999px;overflow:hidden}
#overallFill{height:100%;width:0%;background:#20c997;transition:width .25s ease}
#overallLabel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:12px;font-weight:700;color:#fff;white-space:nowrap;pointer-events:none}

/* Fixed bottom A–Z bar (3 rows of 9) */
#azBar{
  position:fixed;
  left:0; right:0; bottom:0;
  z-index:9999;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  max-width:900px;
  margin:0 auto;
  padding:8px 10px;
  background:rgba(15,23,48,.96);
  backdrop-filter:saturate(120%) blur(4px);
  box-shadow:0 -6px 16px rgba(0,0,0,.35);
  border-top:1px solid rgba(255,255,255,.08);
  border-radius:12px 12px 0 0;
}
#azBar .azbtn{
  flex:0 0 calc(100% / 9 - 8px);
  margin:4px;
  text-align:center;
}
/* Make room so content isn't covered by fixed A–Z */
body{ padding-bottom: 132px; }

.btn:disabled{opacity:.5;cursor:not-allowed}

/* Bottom-fixed A–Z keyboard: 3 rows x 9 (27 chars) */
#azBar{
  position:fixed;
  left:0; right:0; bottom:0;
  z-index: 1000;
  display:grid;
  grid-template-columns: repeat(9, 1fr);
  gap: 6px 6px;
  padding: 10px 12px 12px;
  background: rgba(13, 18, 25, 0.96);
  backdrop-filter: saturate(120%) blur(6px);
  box-shadow: 0 -4px 12px rgba(0,0,0,0.25);
}
#azBar .azbtn{
  text-align:center;
  min-height: 38px;
}
/* Keep it centered within reasonable width on large screens */
@media (min-width: 760px){
  #azBar{ max-width: 720px; margin: 0 auto; left:0; right:0; }
}
/* Make sure page content isn't hidden behind the fixed keyboard */
body{ padding-bottom: 160px; }

.copyRow{display:flex;justify-content:center;gap:12px;margin-top:8px}
.copyRow .btn{flex:1}

.copyopen .btn{width:auto;flex:1}

/* --- Safe area for fixed bottom A–Z keyboard --- */
:root{ --azSafe: 0px; }
body{ padding-bottom: var(--azSafe); }
/* If your content uses a main container instead of body, this keeps it safe too */
main{ padding-bottom: var(--azSafe); }

/* Vertical A–Z index */
#azIndex{
  position: fixed;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 6px;
  z-index: 10010;
  background: transparent;
  padding: 4px 0;
}
#azIndex .azIndexBtn{
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 800;
  background: rgba(255,255,255,0.06);
  color: var(--ink, #cfd8e3);
  border: 1px solid rgba(255,255,255,0.08);
  user-select: none;
}
#azIndex .azIndexBtn.active{ background: rgba(64,147,255,0.35); }
#azIndex .azIndexBtn.disabled{ opacity: 0.35; pointer-events: none; }

/* Remove bottom A–Z keyboard entirely */
#azBar{display:none !important;}
:root{ --azSafe: 0px !important; }
/* Remove any spacer effect */
#azSafeSpacer, #azBottomPad{display:none !important; height:0 !important; margin:0 !important; padding:0 !important;}

/* Bigger vertical A–Z index */
#azIndex{ right: 8px; gap: 8px; }
#azIndex .azIndexBtn{
  width: 34px;
  height: 34px;
  font-size: 14px;
  border-radius: 10px;
}

/* Make right index not block scrolling, and give it its own background */
#azIndex{
  position: fixed;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 10010;
  /* visual container so it doesn't look like it's overlaying content */
  background: rgba(13,18,25,0.72);
  backdrop-filter: blur(6px);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 12px;
  padding: 8px 6px;
  pointer-events: none; /* do NOT block page scroll drags */
}
#azIndex .azIndexBtn{
  pointer-events: auto; /* only the letters are clickable */
  width: 34px;
  height: 34px;
  font-size: 14px;
  border-radius: 10px;
  background: rgba(255,255,255,0.06);
  color: var(--ink, #cfd8e3);
  border: 1px solid rgba(255,255,255,0.1);
}
#azIndex .azIndexBtn.active{ background: rgba(64,147,255,0.35); }
#azIndex .azIndexBtn.disabled{ opacity: 0.35; pointer-events: none; }

/* Make right index scrollable so you can reach A and Z */
#azIndex{
  pointer-events: auto;           /* allow scrolling inside the index */
  max-height: 88vh;               /* fit on screen */
  overflow-y: auto;               /* scroll the letters */
  -webkit-overflow-scrolling: touch; /* smooth on iOS */
}

/* Anchor right A–Z index just below the header/progress (top set dynamically) */
#azIndex{
  position: fixed;
  right: 6px;
  transform: none;
}

/* Visually disable Not Needed when Order > 0 */
#notNeededBtn:disabled{
  opacity: .5;
  pointer-events: none;
  filter: grayscale(0.2);
}

/* Plain text Not Needed list at bottom */
#notNeededSection{ margin-top:24px; padding-top:12px; border-top:1px solid rgba(255,255,255,0.08); }
#notNeededSection h3{ margin:0 0 8px 0; font-size:14px; opacity:.85; }
#notNeededList{ white-space:pre-wrap; font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-size:13px; line-height:1.4; margin:0; }

/* Fade answered current item */
.answeredFade { opacity: 0.5; transition: opacity .2s ease; }

/* Auto-shrinking running order window */
#orderMinus {
  min-height: 40px;
  max-height: 40vh;
  overflow-y: auto;
  transition: max-height .3s ease;
}

/* Smaller top item name */

#itemName {
  background: #FFD700 !important;
  color: #000 !important;
  font-weight: bold !important;
  font-size: clamp(18px, 4vw, 28px) !important;
  padding: 10px 12px !important;
  text-align: center !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

/* Bigger top item name */

#itemName {
  background: #FFD700 !important;
  color: #000 !important;
  font-weight: bold !important;
  font-size: clamp(18px, 4vw, 28px) !important;
  padding: 10px 12px !important;
  text-align: center !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}


/* Top flash notification (appears under header, fades out) */
#topFlash{
  position: fixed;
  top: 8px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(25, 135, 84, 0.95); /* subtle green */
  color: #fff;
  padding: 8px 14px;
  border-radius: 999px;
  font-weight: 700;
  font-size: 13px;
  z-index: 10050;
  box-shadow: 0 4px 14px rgba(0,0,0,0.25);
  opacity: 0;
  pointer-events: none;
  transition: opacity .25s ease, transform .25s ease;
}
#topFlash.show{
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* Plain text Unanswered list at bottom */
#unansweredSection{ margin-top:24px; padding-top:12px; border-top:1px solid rgba(255,255,255,0.08); }
#unansweredSection h3{ margin:0 0 8px 0; font-size:14px; opacity:.85; }
#unansweredList{ white-space:pre-wrap; font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-size:13px; line-height:1.4; margin:0; }

.keybtn {
  font-size:22px;
  padding:14px;
  min-width:50px;
  min-height:50px;
}


/* Hold-to-scroll visual feedback */
.azbtn.hold, .azIndexBtn.hold, .navbtn.hold, .stepbtn.hold, .prev.hold, .next.hold {
  
  filter: brightness(1.15);
}


/* Bigger alphabet buttons */
.azbtn, .azIndexBtn {
  font-size: clamp(24px, 5vw, 42px) !important;
  font-weight: bold !important;
  padding: 14px 20px !important;
  margin: 6px !important;
  border: 2px solid #333 !important;
  border-radius: 8px !important;
  background-color: #f9f9f9 !important;
  color: #222 !important;
}
.azbtn:hover, .azIndexBtn:hover {
  background-color: #333 !important;
  color: #fff !important;
}


/* === A–Z count badges (green style) === */
.azbtn, .azIndexBtn { position: relative; }
.az-badge {
  position: absolute;
  top: -6px;
  right: -6px;
  min-width: 20px;
  height: 20px;
  padding: 0 6px;
  border-radius: 10px;
  font-size: 12px;
  line-height: 20px;
  text-align: center;
  background: #2ecc71; /* green */
  color: #fff;
  pointer-events: none;

  pointer-events: none !important;
  user-select: none;
  -webkit-user-select: none;
  touch-action: none;
}
.azbtn.az-empty, .azIndexBtn.az-empty { opacity: 0.5; }


/* === A–Z count badges (green) === */
.azbtn, .azIndexBtn { position: relative; }
.az-badge {
  position: absolute;
  top: -6px;
  right: -6px;
  min-width: 20px;
  height: 20px;
  padding: 0 6px;
  border-radius: 10px;
  font-size: 12px;
  line-height: 20px;
  text-align: center;
  background: #2ecc71; /* green */
  color: #fff;
  pointer-events: none;
}
.azbtn.az-empty, .azIndexBtn.az-empty { opacity: 0.5; }


.az-badge {
  pointer-events: none !important;
  user-select: none !important;
  touch-action: none !important;
}


/* Hide-empty support */
.az-hidden { display: none !important; }


/* Answered filtering */
.answered-flag { outline: 2px dashed #2ecc71; outline-offset: 4px; }

</style>

<style>
#filterCard .btnrow button {
  flex: 1 1 auto;
  font-size: 0.9em;
  padding: 6px 8px;
  min-width: auto;
}
</style>


<style>
#filterRow .btn.filter-active { outline: 5px solid #ff9800 !important; box-shadow: 0 0 25px 8px #ff9800 !important; border-color: #ff9800 !important; }
</style>


<style>
/* Force the 'All' button to show a thick orange border + glow */
#filterAllBtn{
  outline: 5px solid #ff9800 !important;
  box-shadow: 0 0 25px 8px #ff9800 !important;
  border-color: #ff9800 !important;
}
</style>


<style>
/* Make the selected/tapped (focus/active) category show an orange glow instead of blue */
#filterRow .btn:focus,
#filterRow .btn:focus-visible,
#filterRow .btn:active {
  outline: 5px solid #ff9800 !important;
  box-shadow: 0 0 25px 8px #ff9800 !important;
  border-color: #ff9800 !important;
}
/* Kill the global blue focus ring inside the filter row */
#filterRow .btn:focus { box-shadow: 0 0 25px 8px #ff9800 !important; }
</style>


<style>
/* Disable focus/active glow on filter buttons so only the active class controls it */
#filterRow .btn:focus,
#filterRow .btn:focus-visible,
#filterRow .btn:active {
  outline: none !important;
  box-shadow: none !important;
}
</style>


<style>
/* Only glow when .filter-active; explicitly suppress glow on ALL when not active */
#filterAllBtn:not(.filter-active){
  outline: none !important;
  box-shadow: none !important;
  border-color: var(--ui-2, #2a2f3a) !important; /* neutral border */
}
/* Also neutralize the 'ghost' style when not active */
#filterRow #filterAllBtn.ghost:not(.filter-active){
  background: var(--chip-bg, #d9dbe3) !important;
  color: var(--chip-fg, #1a1f2a) !important;
}
</style>


<style>
/* Floating Prev/Next controls */
#floatingNav {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 16px;
  display: flex;
  justify-content: center;
  gap: 16px;
  z-index: 9999;
  pointer-events: none; /* container ignores taps so clicks only hit buttons */
}
#floatingNav .float-btn {
  pointer-events: auto; /* buttons remain clickable */
  padding: 12px 18px;
  border-radius: 999px;
  font-size: 16px;
  border: 2px solid var(--accent, #ff9800);
  background: rgba(0,0,0,0.6);
  color: #fff;
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.4);
}
#floatingNav .float-btn:active {
  transform: translateY(1px);
}
@media (max-width: 480px){
  #floatingNav .float-btn { padding: 12px 14px; font-size: 15px; }
}
</style>


<style>
/* === Category 'left' badges (green like the alphabet counts) === */
#filterRow .btn { position: relative; } /* anchor */
.cat-left-badge{
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  min-width: 18px;
  height: 18px;
  line-height: 18px;
  padding: 0 6px;
  border-radius: 999px;
  background: #26c281;
  color: #fff;
  font-size: 11px;
  font-weight: 800;
  text-align: center;
  pointer-events: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.35);
}
</style>


<style>
/* Snugger A–Z alphabet badges */
.alpha-badge, .alphabet-badge, .letter-btn {
  padding: 2px 6px !important;
  min-width: 20px !important;
  height: 20px !important;
  line-height: 20px !important;
  font-size: 12px !important;
  border-radius: 6px !important;
}
</style>


<style>
/* Plain A–Z letters, no background bezel */
.alpha-badge, .alphabet-badge, .letter-btn {
  background: none !important;
  border: none !important;
  padding: 0 !important;
  min-width: auto !important;
  height: auto !important;
  line-height: 1.2 !important;
  font-size: 14px !important;
  font-weight: bold !important;
  color: #000 !important; /* black text */
}
</style>


<style>
/* Remove any vertical rail/panel background behind the alphabet */
#azIndex, #azIndex::before, #azIndex::after,
.azIndexWrap, .alphabet-rail, .alpha-rail, .az-rail, .azContainer, .alphaContainer {
  background: transparent !important;
  box-shadow: none !important;
  border: 0 !important;
}
</style>


<style>
/* Make alphabet letter buttons fully transparent (no blur/box) */
.azbtn, .azIndexBtn, .alpha-badge, .alphabet-badge, .letter-btn {
  background: transparent !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  box-shadow: none !important;
  border: none !important;
}
/* Keep letters visible */
.azbtn, .azIndexBtn {
  color: #ffffff !important;
  font-weight: 700 !important;
}
</style>


<style>
/* Nuke ALL backgrounds/blur/shadows on the alphabet rail and its descendants */
#azIndex, #azIndex *,
.azIndex, .azIndex *, 
.azbar, .azbar *, 
.azIndexWrap, .azIndexWrap *,
.alpha-rail, .alpha-rail *, 
.alphabet-rail, .alphabet-rail * {
  background: transparent !important;
  box-shadow: none !important;
  border: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  filter: none !important;
}
</style>


<style>
/* Small yellow oval behind alphabet letters (override previous transparent rule) */
body #azIndex .azbtn,
body #azIndex button.azbtn,
body .azIndex .azbtn {
  background: #FFD54A !important;   /* warm yellow */
  color: #000 !important;            /* black text */
  border: none !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  padding: 2px 6px !important;       /* snug */
  min-width: auto !important;
  height: auto !important;
  line-height: 1.1 !important;
  border-radius: 999px !important;   /* oval / pill */
  text-decoration: none !important;  /* no underline for the letter itself */
  display: inline-block !important;
}
/* Keep the surrounding rail fully transparent */
#azIndex, .azIndex, .azbar, .azIndexWrap {
  background: transparent !important;
  box-shadow: none !important;
  border: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
</style>


<style>
/* Yellow round circle behind alphabet letters - apply to all likely classes */
#azIndex button,
#azIndex .azbtn,
#azIndex .azIndexBtn,
#azIndex .letter-btn,
.azbtn, .azIndexBtn, .letter-btn {
  background: #FFD700 !important;    /* bright yellow */
  color: #000 !important;            /* black text */
  border: none !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.25) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  width: 22px !important;
  height: 22px !important;
  line-height: 22px !important;
  border-radius: 50% !important;
  text-align: center !important;
  font-weight: bold !important;
  font-size: 13px !important;
  padding: 0 !important;
  display: inline-block !important;
}
/* Ensure the alphabet rail container is transparent */
#azIndex, .azIndex, .azbar, .azIndexWrap {
  background: transparent !important;
  box-shadow: none !important;
  border: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
</style>


<style>
/* FORCE yellow circular style for ALL alphabet letter buttons */
#azIndex button,
#azIndex .azbtn,
#azIndex .azIndexBtn,
#azIndex .letter-btn,
.azIndex .azbtn,
.azIndex .azIndexBtn,
.azIndex .letter-btn {
  background: #FFD700 !important;    /* bright yellow */
  color: #000 !important;            /* black text */
  border: none !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.25) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  width: 22px !important;
  height: 22px !important;
  line-height: 22px !important;
  border-radius: 50% !important;
  text-align: center !important;
  font-weight: 800 !important;
  font-size: 13px !important;
  padding: 0 !important;
  display: inline-block !important;
}

/* Make sure any inner spans don't override background */
#azIndex button *,
#azIndex .azbtn *,
#azIndex .azIndexBtn *,
#azIndex .letter-btn * {
  background: transparent !important;
  box-shadow: none !important;
}

/* Rail stays transparent */
#azIndex, .azIndex, .azbar, .azIndexWrap {
  background: transparent !important;
  box-shadow: none !important;
  border: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
</style>


<style>
/* Floating Back to Top button (safe-area aware; offset from A–Z rail) */
#backToTop{
  position: fixed;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 86px);
  right: calc(env(safe-area-inset-right, 0px) + 72px); /* leave room for A–Z rail */
  z-index: 2147483000;
  pointer-events: none; /* container ignores taps */
}

#backToTopBtn {
  pointer-events: auto;
  background: #ffcc00;    /* bright yellow */
  color: #000;
  font-weight: 800;
  border: 2px solid #000;
  border-radius: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  font-size: 16px;
  padding: 10px 16px;
}

@media (max-width: 420px){
  #backToTop{ right: calc(env(safe-area-inset-right, 0px) + 68px); }
}
</style>






<style>
/* Only fade elements marked notneeded; no strike-through globally */
.notneeded {
  opacity: 0.5 !important;
  text-decoration: none !important;
}
</style>


<style>
/* Ensure strike-through is visible on the big title too */
#itemName.notneeded, #itemName.notneeded * {
  text-decoration: line-through !important;
  text-decoration-color: #ff3b30 !important;
  text-decoration-thickness: 2px;
  text-decoration-skip-ink: none;
}
#itemName { position: relative; }
/* Red line fallback overlay for stubborn WebKit cases */

#itemName.notneeded::after {
  content: "";
  position: absolute;
  left: 12px;
  right: 12px;
  top: 1.1em; /* adjusted to align with text */
  border-top: 2px solid #ff3b30;
  pointer-events: none;
}

</style>


<style>
/* Robust strike-through for the title text */
#itemName .nn-strike {
  text-decoration: line-through;
  text-decoration-color: #ff3b30;
  text-decoration-thickness: 3px;
  text-decoration-skip-ink: none;
}
</style>








<style>
button#resetAllBtn {
  background: #d32f2f !important; /* strong red */
  color: #000 !important;         /* black text */
  font-weight: 900 !important;
  font-size: 24px !important;     /* larger text */
  border: 2px solid #000 !important;
}
</style>

</head>
<body>
<body>

<span id="last-sync" style="position:fixed; top:6px; right:10px; color:#9ee; font-size:13px; z-index:9999;"></span>
<div id="last-sync" style="position:absolute; top:8px; right:8px; font-size:12px; color:#ccc;"></div><div id="topFlash"></div>
<header><div id="progressWrap"><div id="progressBar"><div id="progressFill"></div></div><div id="progressRight"><div id="progressTally">Responded: 0 / 0</div><button class="navbtn" id="nextUnansweredBtn">Next Unanswered ▶</button></div></div>
<div class="head">
<button class="navbtn" id="prevBtn">◀ Prev</button>
<h1 id="itemName">ITEM</h1><span id="answeredTick">✓</span>
<button class="navbtn" id="nextBtn">Next ▶</button>
</div>
<div class="counter" id="counter">0 / 100</div>
<div class="azbar" id="azBar"></div>
<div class="status" id="statusLine">Loading…</div></header></div></div>
<div class="wrap">
<div class="card" id="filterCard" style="margin-bottom:12px;">
  <div class="small" style="margin-bottom:6px">FILTER BY LOCATION</div>
  <div class="btnrow" id="filterRow" style="grid-template-columns: repeat(5, 1fr);">
    <button class="btn ghost" id="filterAllBtn">All</button>
    <button class="btn" id="filterColdBtn">Cold Room</button>
    <button class="btn" id="filterGardenBtn">Garden</button>
    <button class="btn" id="filterSideBtn">Side Door</button>
    <button class="btn" id="filterOutsideBtn">Outside</button>
  </div>
</div>

<div class="card" id="itemCard">
<div class="grid">
<div>
<div class="label">STOCK</div>
<div class="stepperwrap"><button class="stepbtn" id="stockMinus" type="button">−</button><input class="inp" id="stockInput" type="number" step="0.01" inputmode="decimal"/><button class="stepbtn" id="stockPlus" type="button">+</button></div>
</div>
<div>
<div class="label">ORDER</div>
<div class="stepperwrap"><button class="stepbtn" id="orderMinus" type="button">−</button><input class="inp" id="orderInput" type="number" step="0.01" inputmode="decimal"/><button class="stepbtn" id="orderPlus" type="button">+</button></div>
</div>
</div>
<div class="btnrow" id="saveButtonsRow"><button class="btn btn-passions" id="savePassionsBtn">SAVE TO PASSIONS</button><button class="btn btn-mk" id="saveMkBtn">SAVE TO MK</button><button class="btn btn-other" id="saveOtherBtn">SAVE TO OTHER</button></div>
<div class="btnrow" style="margin-top:10px"><button class="btn red" id="notNeededBtn" style="grid-column:1 / span 3">NOT NEEDED</button>
<div style="width:100%; display:flex; justify-content:center; margin-top:8px;">
  <button class="btn ghost" id="undoBtn" style="display:none;">UNDO</button>
</div></div>
<hr class="sep"/>
<div>
<div class="label">NOTES FOR ITEM</div>
<textarea class="note" id="noteInput" placeholder="Optional note…"></textarea>
<button class="btn" id="submitStockBtn" style="margin-top:12px; width:100%; background: #5e3ea1; color:#fff;">SUBMIT STOCK</button>




</div>
</div>
<div class="card">
<div class="small" style="margin-bottom:6px">RUNNING ORDER — PASSIONS (Needed × Item)</div>
<div class="area" id="orderListPassions"></div>
<div class="copyopen">
<button class="btn" id="copyPassions">COPY</button>
<a class="btn green" href="#" id="waPassions" rel="noopener" target="_blank">WHATSAPP</a>
</div>
</div>
<div class="card">
<div class="small" style="margin-bottom:6px">RUNNING ORDER — MK (Needed × Item)</div>
<div class="area" id="orderListMk"></div>
<div class="copyopen">
<button class="btn" id="copyMk">COPY</button>
<a class="btn green" href="#" id="waMk" rel="noopener" target="_blank">WHATSAPP</a>
</div>
</div>
<div class="card">
<div class="small" style="margin-bottom:6px">RUNNING ORDER — OTHER (Needed × Item)</div>
<div class="area" id="orderListOther"></div>
<div class="copyopen">
<button class="btn" id="copyOther">COPY</button>
<a class="btn green" href="#" id="waOther" rel="noopener" target="_blank">WHATSAPP</a>
</div>
</div>
<div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:16px;">
<button class="btn red" id="resetBtn">⚠️ RESET ALL ⚠️</button>
<button class="btn ghost" id="editBtn">EDIT ITEMS</button>
</div>
<div class="card editor" id="editorPanel">
<div class="small" style="margin-bottom:6px">ITEMS EDITOR (one item per line)</div>
<textarea class="textarea" id="itemsTextarea" spellcheck="false"></textarea>
<div class="counterline" id="editorCount">Unique lines: 0</div>
<div class="editorbar">
<button class="btn green" id="saveItemsBtn">Save List</button>
<button class="btn ghost" id="cancelEditBtn">Cancel</button>
</div>
<div class="editor-tools">
<input id="newItemInput" placeholder="Add new item… (auto-UPPERCASE)" type="text"/>
<button class="btn" id="addItemBtn">Add Item</button>
<button class="btn" id="addQuickBtn">Add “NEW ITEM”</button>
</div>
<div class="small" style="margin-top:6px">
      No exact duplicates allowed (case-insensitive). Keeping a name the same preserves its saved values.
    </div>
</div>
</div>

<div id="azIndex"></div><script>
// --- Auto-jump from STOCK to ORDER ---
document.addEventListener('DOMContentLoaded', function(){
  var stock = document.getElementById('stockInput');
  var order = document.getElementById('orderInput');
  if (!stock || !order) return;

  function focusOrderAggressive(){
    try {
      order.setAttribute('type','tel');
      order.setAttribute('inputmode','numeric');
      order.setAttribute('pattern','[0-9]*');
      order.setAttribute('autocomplete','one-time-code');
    } catch(e){}
    try { order.focus(); order.select && order.select(); } catch(e){}
    try { order.click && order.click(); } catch(e){}
    setTimeout(function(){
      try { order.focus(); order.select && order.select(); } catch(e){}
    }, 0);
  }

  stock.addEventListener('keydown', function(ev){
    if (ev.key === 'Enter') {
      ev.preventDefault();
      focusOrderAggressive();
    }
  });

  stock.addEventListener('blur', function(){
    if (!order.value) {
      focusOrderAggressive();
    }
  });
});


// --- Top flash helper ---
function showTopFlash(msg, ms){
  try{
    // Suppress the green top banner specifically for "Not Needed" notices
    if (msg && /not\s+needed/i.test(msg)) { return; }
    var node = document.getElementById('topFlash');
    if (!node) return;
    node.textContent = msg || 'Done';
    node.classList.add('show');
    clearTimeout(window.__topFlashTimer);
    window.__topFlashTimer = setTimeout(function(){
      node.classList.remove('show');
    }, ms || 1400);
  }catch(e){}
}



function buildUnansweredList(){
  try{
    var box = document.getElementById('unansweredList');
    if (!box) return;
    var list = [];
    for (var i=0;i<ITEMS.length;i++){
      var nm = ITEMS[i];
      var rec = state.map[nm];
      var answered = false;
      try{
        if (typeof isResponded === 'function'){
          answered = isResponded(rec);
        } else {
          answered = !!(rec && (rec.status === 'notneeded' || rec.bucket));
        }
      }catch(e){ answered = false; }
      if (!answered) list.push(nm);
    }
    list.sort(function(a,b){ return a.localeCompare(b,'en',{sensitivity:'base'}); });
    box.textContent = list.join("\n");
  }catch(e){}
}
</script><section id="unansweredSection"><h3>Unanswered (A–Z)</h3><pre id="unansweredList"></pre></section>
<section id="notNeededSection"><h3>Not Needed (A–Z)</h3><pre id="notNeededList"></pre></section><script>try{buildUnansweredList();}catch(e){}

// --- Soft click sound (always on) ---
(function(){
  var AC = window.AudioContext || window.webkitAudioContext;
  var ctx = null;
  window.playClick = function(){
    try{
      if (!AC) return;
      ctx = ctx || new AC();
      var t = ctx.currentTime;
      var osc = ctx.createOscillator();
      var gain = ctx.createGain();
      osc.type = 'square';
      osc.frequency.setValueAtTime(880, t);
      gain.gain.setValueAtTime(0.0001, t);
      // Softer peak and shorter duration
      gain.gain.exponentialRampToValueAtTime(0.03, t + 0.004);
      gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.045);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start(t);
      osc.stop(t + 0.05);
    }catch(e){ /* no-op */ }
  };
})();</script>
<script>
// Simple hold-to-repeat utility that just triggers .click() on the target
(function(){
  function addHoldRepeat(el, opts){
    opts = opts || {};
    var initDelay = opts.initialDelay || 500;
    var repeat = opts.repeat || 160;
    var accelerate = !!opts.accelerate;
    var timer = null, repeater = null, interval = repeat, accelStep = 0;
    var down = false;

    function clearTimers(){
      if (timer) { clearTimeout(timer); timer = null; }
      if (repeater) { clearInterval(repeater); repeater = null; }
      if (down) { el.classList.remove('hold'); down = false; }
      interval = repeat; accelStep = 0;
    }

    function step(){
      try {
        // Prefer lightweight direct calls over .click()
        var L = (el.dataset && el.dataset.letter) || (el.textContent||'').trim();
        if ((el.classList && (el.classList.contains('azbtn') || el.classList.contains('azIndexBtn'))) && (typeof window.azCycleContinuous === 'function' || typeof window.azCycle === 'function')){
          if (typeof window.azCycleContinuous==='function') window.azCycleContinuous(L, +1); else window.azCycle(L, +1);
        } else if ((el.id === 'nextBtn' || el.classList.contains('next') || el.getAttribute('data-role') === 'next') && typeof window.show === 'function'){
          if (!window.__inFlight){ window.__inFlight = true; window.show((window.state && window.state.i || 0) + 1); requestAnimationFrame(function(){ window.__inFlight = false; }); }
        } else if ((el.id === 'prevBtn' || el.classList.contains('prev') || el.getAttribute('data-role') === 'prev') && typeof window.show === 'function'){
          if (!window.__inFlight){ window.__inFlight = true; window.show((window.state && window.state.i || 0) - 1); requestAnimationFrame(function(){ window.__inFlight = false; }); }
        } else {
          el.click();
        }
      } catch(e) {}
    }

    function start(){
      down = true;
      el.classList.add('hold');
      step(); // immediate for snappy feel
      timer = setTimeout(function(){
        repeater = setInterval(function(){
          step();
          if (accelerate && interval > 25){
            accelStep++;
            if (accelStep % 6 === 0){ interval = Math.max(120, interval - 4);
              clearInterval(repeater);
              repeater = setInterval(step, interval);
            }
          }
        }, interval);
      }, initDelay);
    }

    // Mouse
    el.addEventListener('mousedown', function(ev){ if (ev.button===0) start(); });
    document.addEventListener('mouseup', clearTimers);
    el.addEventListener('mouseleave', clearTimers);

    // Touch
    el.addEventListener('touchstart', function(){ start(); }, {passive:true});
    el.addEventListener('touchend', clearTimers, {passive:true});
    el.addEventListener('touchcancel', clearTimers, {passive:true});
  }

  function wire(){
    // A–Z bars (bottom and side)
    document.querySelectorAll('.azbtn, .azIndexBtn').forEach(function(btn){
      addHoldRepeat(btn, {initialDelay: 300, repeat: 100, accelerate: true});
    });

    // Prev/Next style controls if present
    var prev = document.getElementById('prevBtn') || document.querySelector('.prev, [data-role="prev"]');
    var next = document.getElementById('nextBtn') || document.querySelector('.next, [data-role="next"]');
    if (prev) addHoldRepeat(prev, {initialDelay: 300, repeat: 90, accelerate: true});
    if (next) addHoldRepeat(next, {initialDelay: 300, repeat: 90, accelerate: true});

    // Keyboard shortcuts: arrows trigger existing clicks
    document.addEventListener('keydown', function(ev){
      if (ev.altKey || ev.metaKey || ev.ctrlKey) return;
      var tag = (ev.target && ev.target.tagName) || '';
      if (tag === 'INPUT' || tag === 'TEXTAREA') return;
      if (ev.key === 'ArrowRight'){ saveCurrent(); if (typeof window.show((window.state&&window.state.i||0)+1); requestAnimationFrame(function(){ window.__inFlight=false; }); ev.preventDefault(); } } }
      else if (ev.key === 'ArrowLeft'){ saveCurrent(); if (typeof window.show((window.state&&window.state.i||0)-1); requestAnimationFrame(function(){ window.__inFlight=false; }); ev.preventDefault(); } } }
      else if (ev.key === 'ArrowDown'){
        var activeAZ = document.querySelector('.azbtn.active') || document.querySelector('.azIndexBtn.active') || document.querySelector('.azbtn') || document.querySelector('.azIndexBtn');
        if (activeAZ){ activeAZ.click(); ev.preventDefault(); }
      }
    });
  }

  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', wire);
  else wire();
})();
</script>







<div id="notCheckedModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999; align-items:center; justify-content:center;">
  <div style="background:#222; position:relative; color:#fff; padding:20px; border-radius:12px; max-height:80%; overflow-y:auto; width:80%; max-width:400px;">
    <div style="position:absolute; top:10px; right:12px; cursor:pointer; font-size:24px; color:#fff;" onclick="hideMissingAndJump();">&times;</div>
    <div style="font-weight:bold; font-size:18px; margin-bottom:12px;">You have NOT checked stock for:</div>
    <div id="notCheckedList" style="white-space:pre-line; font-size:16px; line-height:1.4;"></div>
    <div style="text-align:right; margin-top:15px;">
      <button onclick="hideMissingAndJump();" style="background:#444; color:#fff; border:none; padding:8px 14px; border-radius:6px; font-size:16px;">Close</button>
    </div>
  </div>
</div>

<script>
function showNotChecked(list){
  window._missingList = list;
  var modal = document.getElementById("notCheckedModal");
  var box = document.getElementById("notCheckedList");
  box.textContent = list.join("\n");
  modal.style.display = "flex";
}
</script>

<script>
document.addEventListener('click', function(e){
  if(e.target && (e.target.classList.contains('modal-close') || e.target.innerText === '×')){
    if(typeof window.__firstMissingIdx === 'number' && window.__firstMissingIdx >= 0){
      show(window.__firstMissingIdx);
    }
  }
});
</script>

<script>
function hideMissingAndJump(){
  var modal = document.getElementById('notCheckedModal');
  modal.style.display='none';
  if(window._missingList && window._missingList.length > 0){
    var first = window._missingList[0];
    var idx = ITEMS.indexOf(first);
    if(idx >= 0){
      state.map[first] = state.map[first] || {};
      state.map[first].stock = "";
      show(idx);
    }
  }
}
</script>

<script>
(function(){
  var btn = document.getElementById('submitStockBtn');
  if(!btn) return;
  btn.onclick = function(){
    var missing = [];
    window.__firstMissingIdx = -1;

    for(var i=0;i<ITEMS.length;i++){
      var nm = ITEMS[i];
      var rec = state.map[nm] || {};
      var st = (rec.stock||"").trim();
      if(rec.status !== "notneeded" && st === ""){
        missing.push(nm);
        if(window.__firstMissingIdx === -1) window.__firstMissingIdx = i;
      }
    }

    if(missing.length){
      showNotChecked(missing);
      return;
    }

    var values = [];
    for(var i=0;i<ITEMS.length;i++){
      var nm = ITEMS[i];
      var rec = state.map[nm] || {};
      if(rec.status === "notneeded"){
        values.push("-1");
      } else {
        var v = (rec.stock||"").trim();
        if(v === "") v = "0";
        values.push(v);
      }
    }

    var encoded = encodeURIComponent(values.join(","));
    var thisFile = (function(){
      var s = location.pathname.split("/");
      return s[s.length-1]||"v174.html";
    })();

    var url = "https://farquan.github.io/orderpad/" + thisFile + "?x=" + encoded;

    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(url).catch(function(){});
    }

    window.open(url, "_blank");
    var wa = "https://wa.me/?text=" + encodeURIComponent("Stock Completed ✅\n" + url);
    window.open(wa, "_blank");
  };
})();
</script>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyMqy6ho3iFTwCGotNg6gYyYSkEbYhBSCaYA2BzQPiofu3E2jTBytvA5LSrtmpQE5SR/exec";

function saveCurrent(){
  try{
    var item = ITEMS[state.i];
    if(!item) return;
    var qty = (state.map[item] && state.map[item].stock != null) ? state.map[item].stock : "";
    const payload = { [item]: qty };
    const url = SCRIPT_URL + "?action=save&data=" + encodeURIComponent(JSON.stringify(payload));
    fetch(url).then(r=>{
      if(!r.ok) throw new Error("HTTP "+r.status);
      return r.text();
    }).catch(e=>{
      console.warn("Save failed:", e);
    });
  }catch(e){ console.error("Critical Save Error:", e); }
}


function loadStockFromSheet(){
  fetch(SCRIPT_URL + "?action=load")
    .then(r=>r.json())
    .then(obj=>{
      if(!obj || !obj.data) return;
      const data = obj.data;
      for(const name in data){
        const qty = data[name];
        if(window.state && state.map && state.map[name]){
          state.map[name].stock = String(qty);
        }
      }
      if(window.state && typeof show === "function"){
        show(state.i);
      }
    })
    .catch(e=>console.warn(e));
}



</script>

<script>

<script>
// ===== LOAD ITEM LIST (NAME + CATEGORY) FROM GOOGLE SHEET =====
fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9pTMWZLNo6EJGOu475l8_cUMtiOTd9P0hGS4pR43Z0cNpUiDT9-O4kGPQ6czmigUuhWTD6sAhYLYc/pub?gid=223224205&single=true&output=csv")
  .then(r => r.text())
  .then(t => {
    let rows = t.trim().split(/\r?\n/);
    rows.shift(); // remove header

    let itemList = [];
    let itemLocations = {};

    rows.forEach(line => {
      const parts = line.split(",");
      const name = (parts[0] || "").trim();
      const category = (parts[1] || "").trim();
      if (name) {
        itemList.push(name);
        itemLocations[name] = category;
      }
    });

    ITEMS = itemList;
    TOTAL = ITEMS.length;

    try { saveItems(ITEMS); } catch(e){}

    window.LOCATIONS = itemLocations;

    if (window.afterItemsLoaded) window.afterItemsLoaded();
  })
  .catch(err => console.error("Item Load Failed:", err));
</script>

window.afterItemsLoaded = function(){
  loadStockFromSheet();
  setTimeout(()=>{ show(state.i); }, 50);
};
</script>
</body>
</html>